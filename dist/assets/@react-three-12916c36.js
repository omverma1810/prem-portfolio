import{_ as Y}from"./@babel-98964cd2.js";import{r as m}from"./react-12cd6a43.js";import{L as Me,T as Ct,R as xt,U as St,s as et,a as Rt,O as ze,P as Fe,S as Ne,b as Ee,B as jt,M as Ot,C as Tt,V as G,c as kt,W as At,d as Dt,e as zt,f as Ft,g as Lt,h as It,N as Wt,A as Ht,i as Bt,j as $t,D as Nt,k as ge,l as Ut,m as se,n as qt,o as Gt,p as Vt}from"./three-c749621b.js";import{u as Xt}from"./react-use-measure-de5e8fa2.js";import{F as Yt,u as Zt}from"./its-fine-cdfc5e30.js";import{R as Kt,c as ie}from"./react-reconciler-bd6ae26a.js";import{c as Jt}from"./react-dom-a2ee3a8a.js";import{c as tt}from"./zustand-f8c951a8.js";import"./maath-59d1875d.js";import{m as nt}from"./react-merge-refs-239dbb3c.js";var rt={exports:{}},ot={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,E){var P=b.length;b.push(E);e:for(;0<P;){var R=P-1>>>1,S=b[R];if(0<a(S,E))b[R]=E,b[P]=S,P=R;else break e}}function o(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var E=b[0],P=b.pop();if(P!==E){b[0]=P;e:for(var R=0,S=b.length,H=S>>>1;R<H;){var A=2*(R+1)-1,q=b[A],$=A+1,ee=b[$];if(0>a(q,P))$<S&&0>a(ee,q)?(b[R]=ee,b[$]=P,R=$):(b[R]=q,b[A]=P,R=A);else if($<S&&0>a(ee,P))b[R]=ee,b[$]=P,R=$;else break e}}return E}function a(b,E){var P=b.sortIndex-E.sortIndex;return P!==0?P:b.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var g=Date,h=g.now();e.unstable_now=function(){return g.now()-h}}var s=[],v=[],n=1,r=null,c=3,d=!1,p=!1,M=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(b){for(var E=o(v);E!==null;){if(E.callback===null)i(v);else if(E.startTime<=b)i(v),E.sortIndex=E.expirationTime,t(s,E);else break;E=o(v)}}function x(b){if(M=!1,_(b),!p)if(o(s)!==null)p=!0,U(j);else{var E=o(v);E!==null&&F(x,E.startTime-b)}}function j(b,E){p=!1,M&&(M=!1,l(z),z=-1),d=!0;var P=c;try{for(_(E),r=o(s);r!==null&&(!(r.expirationTime>E)||b&&!w());){var R=r.callback;if(typeof R=="function"){r.callback=null,c=r.priorityLevel;var S=R(r.expirationTime<=E);E=e.unstable_now(),typeof S=="function"?r.callback=S:r===o(s)&&i(s),_(E)}else i(s);r=o(s)}if(r!==null)var H=!0;else{var A=o(v);A!==null&&F(x,A.startTime-E),H=!1}return H}finally{r=null,c=P,d=!1}}var C=!1,D=null,z=-1,O=5,k=-1;function w(){return!(e.unstable_now()-k<O)}function T(){if(D!==null){var b=e.unstable_now();k=b;var E=!0;try{E=D(!0,b)}finally{E?B():(C=!1,D=null)}}else C=!1}var B;if(typeof u=="function")B=function(){u(T)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,W=V.port2;V.port1.onmessage=T,B=function(){W.postMessage(null)}}else B=function(){y(T,0)};function U(b){D=b,C||(C=!0,B())}function F(b,E){z=y(function(){b(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,U(j))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return o(s)},e.unstable_next=function(b){switch(c){case 1:case 2:case 3:var E=3;break;default:E=c}var P=c;c=E;try{return b()}finally{c=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,E){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var P=c;c=b;try{return E()}finally{c=P}},e.unstable_scheduleCallback=function(b,E,P){var R=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?R+P:R):P=R,b){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=P+S,b={id:n++,callback:E,priorityLevel:b,startTime:P,expirationTime:S,sortIndex:-1},P>R?(b.sortIndex=P,t(v,b),o(s)===null&&b===o(v)&&(M?(l(z),z=-1):M=!0,F(x,P-R))):(b.sortIndex=S,t(s,b),p||d||(p=!0,U(j))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var E=c;return function(){var P=c;c=E;try{return b.apply(this,arguments)}finally{c=P}}}})(ot);rt.exports=ot;var Ue=rt.exports;const Le={},Qt=e=>void Object.assign(Le,e);function en(e,t){function o(n,{args:r=[],attach:c,...d},p){let M=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=re(l,{type:n,root:p,attach:c,primitive:!0})}else{const l=Le[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=re(new l(...r),{type:n,root:p,attach:c,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y instanceof jt?y.__r3f.attach="geometry":y instanceof Ot&&(y.__r3f.attach="material")),M!=="inject"&&xe(y,d),y}function i(n,r){let c=!1;if(r){var d,p;(d=r.__r3f)!=null&&d.attach?Ce(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),c=!0),c||(p=n.__r3f)==null||p.objects.push(r),r.__r3f||re(r,{}),r.__r3f.parent=n,Ae(r),oe(r)}}function a(n,r,c){let d=!1;if(r){var p,M;if((p=r.__r3f)!=null&&p.attach)Ce(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const y=n.children.filter(u=>u!==r),l=y.indexOf(c);n.children=[...y.slice(0,l),r,...y.slice(l)],d=!0}d||(M=n.__r3f)==null||M.objects.push(r),r.__r3f||re(r,{}),r.__r3f.parent=n,Ae(r),oe(r)}}function f(n,r,c=!1){n&&[...n].forEach(d=>g(r,d,c))}function g(n,r,c){if(r){var d,p,M;if(r.__r3f&&(r.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(x=>x!==r)),(p=r.__r3f)!=null&&p.attach)Ye(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var y;n.remove(r),(y=r.__r3f)!=null&&y.root&&ln(r.__r3f.root,r)}const u=(M=r.__r3f)==null?void 0:M.primitive,_=c===void 0?r.dispose!==null&&!u:c;if(!u){var l;f((l=r.__r3f)==null?void 0:l.objects,r,_),f(r.children,r,_)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,u||delete r.__r3f),_&&r.dispose&&r.type!=="Scene"&&Ue.unstable_scheduleCallback(Ue.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),oe(n)}}function h(n,r,c,d){var p;const M=(p=n.__r3f)==null?void 0:p.parent;if(!M)return;const y=o(r,c,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(y,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(y,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(M,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(M,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Kt({createInstance:o,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const c=n.getState().scene;c.__r3f&&(c.__r3f.root=n,i(c,r))},removeChildFromContainer:(n,r)=>{r&&g(n.getState().scene,r)},insertInContainerBefore:(n,r,c)=>{if(!r||!c)return;const d=n.getState().scene;d.__r3f&&a(d,r,c)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,c,d){if(n.__r3f.primitive&&d.object&&d.object!==n)return[!0];{const{args:p=[],children:M,...y}=d,{args:l=[],children:u,..._}=c;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((j,C)=>j!==l[C]))return[!0];const x=ft(n,y,_,!0);return x.changes.length?[!1,x]:null}},commitUpdate(n,[r,c],d,p,M,y){r?h(n,d,M,y):xe(n,c)},commitMount(n,r,c,d){var p;const M=(p=n.__r3f)!=null?p:{};n.raycast&&M.handlers&&M.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>re(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:c,parent:d}=(r=n.__r3f)!=null?r:{};c&&d&&Ye(d,n,c),n.isObject3D&&(n.visible=!1),oe(n)},unhideInstance(n,r){var c;const{attach:d,parent:p}=(c=n.__r3f)!=null?c:{};d&&p&&Ce(p,n,d),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),oe(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:xe}}var qe,Ge;const it=()=>{var e;return(e=Le.ColorManagement)!=null?e:null},st=e=>e&&e.isOrthographicCamera,tn=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((qe=window.document)!=null&&qe.createElement||((Ge=window.navigator)==null?void 0:Ge.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function at(e){const t=m.useRef(e);return me(()=>void(t.current=e),[e]),t}function nn({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class lt extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}lt.getDerivedStateFromError=()=>({error:!0});const ct="__default",Ve=new Map,rn=e=>e&&!!e.memoized&&!!e.changes;function ut(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const f=I.obj(e);if(f&&i==="reference")return e===t;const g=I.arr(e);if(g&&o==="reference")return e===t;if((g||f)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(f&&o==="shallow"&&i==="shallow"){for(h in a?t:e)if(!I.equ(e[h],t[h],{strict:a,objects:"reference"}))return!1}else for(h in a?t:e)if(e[h]!==t[h])return!1;if(I.und(h)){if(g&&e.length===0&&t.length===0||f&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function on(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function ke(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return o=i.reduce((f,g)=>f[g],e),{target:o,key:a}}else return{target:o,key:t}}const Xe=/-\d+$/;function Ce(e,t,o){if(I.str(o)){if(Xe.test(o)){const f=o.replace(Xe,""),{target:g,key:h}=ke(e,f);Array.isArray(g[h])||(g[h]=[])}const{target:i,key:a}=ke(e,o);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=o(e,t)}function Ye(e,t,o){var i,a;if(I.str(o)){const{target:f,key:g}=ke(e,o),h=t.__r3f.previousAttach;h===void 0?delete f[g]:f[g]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function ft(e,{children:t,key:o,ref:i,...a},{children:f,key:g,ref:h,...s}={},v=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},c=Object.entries(a),d=[];if(v){const M=Object.keys(s);for(let y=0;y<M.length;y++)a.hasOwnProperty(M[y])||c.unshift([M[y],ct+"remove"])}c.forEach(([M,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||I.equ(y,s[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,y,!0,[]]);let u=[];M.includes("-")&&(u=M.split("-")),d.push([M,y,!1,u]);for(const _ in a){const x=a[_];_.startsWith(`${M}-`)&&d.push([_,x,!1,_.split("-")])}});const p={...a};return r.memoizedProps&&r.memoizedProps.args&&(p.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(p.attach=r.memoizedProps.attach),{memoized:p,changes:d}}function xe(e,t){var o,i,a;const f=(o=e.__r3f)!=null?o:{},g=f.root,h=(i=g==null||g.getState==null?void 0:g.getState())!=null?i:{},{memoized:s,changes:v}=rn(t)?t:ft(e,t),n=f.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let c=0;c<v.length;c++){let[d,p,M,y]=v[c],l=e,u=l[d];if(y.length&&(u=y.reduce((_,x)=>_[x],e),!(u&&u.set))){const[_,...x]=y.reverse();l=x.reverse().reduce((j,C)=>j[C],e),d=_}if(p===ct+"remove")if(l.constructor){let _=Ve.get(l.constructor);_||(_=new l.constructor,Ve.set(l.constructor,_)),p=_[d]}else p=0;if(M)p?f.handlers[d]=p:delete f.handlers[d],f.eventCount=Object.keys(f.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Me)){if(Array.isArray(p))u.fromArray?u.fromArray(p):u.set(...p);else if(u.copy&&p&&p.constructor&&u.constructor===p.constructor)u.copy(p);else if(p!==void 0){const _=u instanceof Tt;!_&&u.setScalar?u.setScalar(p):u instanceof Me&&p instanceof Me?u.mask=p.mask:u.set(p),!it()&&!h.linear&&_&&u.convertSRGBToLinear()}}else l[d]=p,!h.linear&&l[d]instanceof Ct&&l[d].format===xt&&l[d].type===St&&(l[d].encoding=et);oe(e)}if(f.parent&&h.internal&&e.raycast&&n!==f.eventCount){const c=h.internal.interaction.indexOf(e);c>-1&&h.internal.interaction.splice(c,1),f.eventCount&&h.internal.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(a=e.__r3f)!=null&&a.parent&&Ae(e),e}function oe(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Ae(e){e.onUpdate==null||e.onUpdate(e)}function sn(e,t){e.manual||(st(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ye(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function an(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function dt(e,t,o,i){const a=o.get(t);a&&(o.delete(t),o.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function ln(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(a)}),o.capturedMap.forEach((i,a)=>{dt(o.capturedMap,t,i,a)})}function cn(e){function t(s){const{internal:v}=e.getState(),n=s.offsetX-v.initialClick[0],r=s.offsetY-v.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(s){return s.filter(v=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(s,v){const n=e.getState(),r=new Set,c=[],d=v?v(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const u=ce(d[l]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function p(l){const u=ce(l);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var _;u.events.compute==null||u.events.compute(s,u,(_=u.previousRoot)==null?void 0:_.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(p).sort((l,u)=>{const _=ce(l.object),x=ce(u.object);return!_||!x?l.distance-u.distance:x.events.priority-_.events.priority||l.distance-u.distance}).filter(l=>{const u=ye(l);return r.has(u)?!1:(r.add(u),!0)});n.events.filter&&(M=n.events.filter(M,n));for(const l of M){let u=l.object;for(;u;){var y;(y=u.__r3f)!=null&&y.eventCount&&c.push({...l,eventObject:u}),u=u.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let l of n.internal.capturedMap.get(s.pointerId).values())r.has(ye(l.intersection))||c.push(l.intersection);return c}function a(s,v,n,r){const c=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const M=ce(p.object)||c,{raycaster:y,pointer:l,camera:u,internal:_}=M,x=new G(l.x,l.y,0).unproject(u),j=k=>{var w,T;return(w=(T=_.capturedMap.get(k))==null?void 0:T.has(p.eventObject))!=null?w:!1},C=k=>{const w={intersection:p,target:v.target};_.capturedMap.has(k)?_.capturedMap.get(k).set(p.eventObject,w):_.capturedMap.set(k,new Map([[p.eventObject,w]])),v.target.setPointerCapture(k)},D=k=>{const w=_.capturedMap.get(k);w&&dt(_.capturedMap,p.eventObject,w,k)};let z={};for(let k in v){let w=v[k];typeof w!="function"&&(z[k]=w)}let O={...p,...z,pointer:l,intersections:s,stopped:d.stopped,delta:n,unprojectedPoint:x,ray:y.ray,camera:u,stopPropagation(){const k="pointerId"in v&&_.capturedMap.get(v.pointerId);if((!k||k.has(p.eventObject))&&(O.stopped=d.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=s.slice(0,s.indexOf(p));f([...w,p])}},target:{hasPointerCapture:j,setPointerCapture:C,releasePointerCapture:D},currentTarget:{hasPointerCapture:j,setPointerCapture:C,releasePointerCapture:D},nativeEvent:v};if(r(O),d.stopped===!0)break}}return s}function f(s){const{internal:v}=e.getState();for(const n of v.hovered.values())if(!s.length||!s.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const c=n.eventObject.__r3f,d=c==null?void 0:c.handlers;if(v.hovered.delete(ye(n)),c!=null&&c.eventCount){const p={...n,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function g(s,v){for(let n=0;n<v.length;n++){const r=v[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function h(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>f([]);case"onLostPointerCapture":return v=>{const{internal:n}=e.getState();"pointerId"in v&&n.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(v.pointerId)&&(n.capturedMap.delete(v.pointerId),f([]))})}}return function(n){const{onPointerMissed:r,internal:c}=e.getState();c.lastEvent.current=n;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(n,d?o:void 0),l=p?t(n):0;s==="onPointerDown"&&(c.initialClick=[n.offsetX,n.offsetY],c.initialHits=y.map(_=>_.eventObject)),p&&!y.length&&l<=2&&(g(n,c.interaction),r&&r(n)),d&&f(y);function u(_){const x=_.eventObject,j=x.__r3f,C=j==null?void 0:j.handlers;if(j!=null&&j.eventCount)if(d){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const D=ye(_),z=c.hovered.get(D);z?z.stopped&&_.stopPropagation():(c.hovered.set(D,_),C.onPointerOver==null||C.onPointerOver(_),C.onPointerEnter==null||C.onPointerEnter(_))}C.onPointerMove==null||C.onPointerMove(_)}else{const D=C[s];D?(!p||c.initialHits.includes(x))&&(g(n,c.interaction.filter(z=>!c.initialHits.includes(z))),D(_)):p&&c.initialHits.includes(x)&&g(n,c.interaction.filter(z=>!c.initialHits.includes(z)))}}a(y,n,l,u)}}return{handlePointer:h}}const pt=e=>!!(e!=null&&e.render),mt=m.createContext(null),un=(e,t)=>{const o=tt((h,s)=>{const v=new G,n=new G,r=new G;function c(l=s().camera,u=n,_=s().size){const{width:x,height:j,top:C,left:D}=_,z=x/j;u instanceof G?r.copy(u):r.set(...u);const O=l.getWorldPosition(v).distanceTo(r);if(st(l))return{width:x/l.zoom,height:j/l.zoom,top:C,left:D,factor:1,distance:O,aspect:z};{const k=l.fov*Math.PI/180,w=2*Math.tan(k/2)*O,T=w*(x/j);return{width:T,height:w,top:C,left:D,factor:x/T,distance:O,aspect:z}}}let d;const p=l=>h(u=>({performance:{...u.performance,current:l}})),M=new kt;return{set:h,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,u)=>t(l,u,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Bt,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>h(u=>({...u,events:{...u.events,...l}})),setSize:(l,u,_,x,j)=>{const C=s().camera,D={width:l,height:u,top:x||0,left:j||0,updateStyle:_};h(z=>({size:D,viewport:{...z.viewport,...c(C,n,D)}}))},setDpr:l=>h(u=>{const _=ut(l);return{viewport:{...u.viewport,dpr:_,initialDpr:u.viewport.initialDpr||_}}}),setFrameloop:(l="always")=>{const u=s().clock;u.stop(),u.elapsedTime=0,l!=="never"&&(u.start(),u.elapsedTime=0),h(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,u,_)=>{const x=s().internal;return x.priority=x.priority+(u>0?1:0),x.subscribers.push({ref:l,priority:u,store:_}),x.subscribers=x.subscribers.sort((j,C)=>j.priority-C.priority),()=>{const j=s().internal;j!=null&&j.subscribers&&(j.priority=j.priority-(u>0?1:0),j.subscribers=j.subscribers.filter(C=>C.ref!==l))}}}}}),i=o.getState();let a=i.size,f=i.viewport.dpr,g=i.camera;return o.subscribe(()=>{const{camera:h,size:s,viewport:v,gl:n,set:r}=o.getState();if(s!==a||v.dpr!==f){var c;a=s,f=v.dpr,sn(h,s),n.setPixelRatio(v.dpr);const d=(c=s.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,d)}h!==g&&(g=h,r(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(h)}})))}),o.subscribe(h=>e(h)),o};let be,fn=new Set,dn=new Set,pn=new Set;function Se(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function ue(e,t){switch(e){case"before":return Se(fn,t);case"after":return Se(dn,t);case"tail":return Se(pn,t)}}let Re,je;function Oe(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Re=t.internal.subscribers,be=0;be<Re.length;be++)je=Re[be],je.ref.current(je.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function mn(e){let t=!1,o,i,a;function f(s){i=requestAnimationFrame(f),t=!0,o=0,ue("before",s);for(const n of e.values()){var v;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((v=a.gl.xr)!=null&&v.isPresenting)&&(o+=Oe(s,a))}if(ue("after",s),o===0)return ue("tail",s),t=!1,cancelAnimationFrame(i)}function g(s,v=1){var n;if(!s)return e.forEach(r=>g(r.store.getState()),v);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+v),t||(t=!0,requestAnimationFrame(f)))}function h(s,v=!0,n,r){if(v&&ue("before",s),n)Oe(s,n,r);else for(const c of e.values())Oe(s,c.store.getState());v&&ue("after",s)}return{loop:f,invalidate:g,advance:h}}function vt(){const e=m.useContext(mt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function _e(e=o=>o,t){return vt()(e,t)}function Ie(e,t=0){const o=vt(),i=o.getState().internal.subscribe,a=at(e);return me(()=>i(a,t,o),[t,i,o]),null}const ae=new Map,{invalidate:Ze,advance:Ke}=mn(ae),{reconciler:we,applyProps:fe}=en(ae,an),ne={objects:"shallow",strict:!1},vn=(e,t)=>{const o=typeof e=="function"?e(t):e;return pt(o)?o:new At({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function hn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:a,left:f}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:a,left:f}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function gn(e){const t=ae.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,f=i||un(Ze,Ke),g=o||we.createContainer(f,ie.ConcurrentRoot,null,!1,null,"",a,null);t||ae.set(e,{fiber:g,store:f});let h,s=!1,v;return{configure(n={}){let{gl:r,size:c,scene:d,events:p,onCreated:M,shadows:y=!1,linear:l=!1,flat:u=!1,legacy:_=!1,orthographic:x=!1,frameloop:j="always",dpr:C=[1,2],performance:D,raycaster:z,camera:O,onPointerMissed:k}=n,w=f.getState(),T=w.gl;w.gl||w.set({gl:T=vn(r,e)});let B=w.raycaster;B||w.set({raycaster:B=new Rt});const{params:V,...W}=z||{};if(I.equ(W,B,ne)||fe(B,{...W}),I.equ(V,B.params,ne)||fe(B,{params:{...B.params,...V}}),!w.camera||w.camera===v&&!I.equ(v,O,ne)){v=O;const R=O instanceof Dt,S=R?O:x?new ze(0,0,0,0,.1,1e3):new Fe(75,0,.1,1e3);R||(S.position.z=5,O&&fe(S,O),!w.camera&&!(O!=null&&O.rotation)&&S.lookAt(0,0,0)),w.set({camera:S})}if(!w.scene){let R;d instanceof Ne?R=d:(R=new Ne,d&&fe(R,d)),w.set({scene:re(R)})}if(!w.xr){const R=(A,q)=>{const $=f.getState();$.frameloop!=="never"&&Ke(A,!0,$,q)},S=()=>{const A=f.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?R:null),A.gl.xr.isPresenting||Ze(A)},H={connect(){const A=f.getState().gl;A.xr.addEventListener("sessionstart",S),A.xr.addEventListener("sessionend",S)},disconnect(){const A=f.getState().gl;A.xr.removeEventListener("sessionstart",S),A.xr.removeEventListener("sessionend",S)}};T.xr&&H.connect(),w.set({xr:H})}if(T.shadowMap){const R=T.shadowMap.enabled,S=T.shadowMap.type;if(T.shadowMap.enabled=!!y,I.boo(y))T.shadowMap.type=Ee;else if(I.str(y)){var U;const H={basic:zt,percentage:Ft,soft:Ee,variance:Lt};T.shadowMap.type=(U=H[y])!=null?U:Ee}else I.obj(y)&&Object.assign(T.shadowMap,y);(R!==T.shadowMap.enabled||S!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const F=it();F&&("enabled"in F?F.enabled=!_:"legacyMode"in F&&(F.legacyMode=_));const b=l?It:et,E=u?Wt:Ht;T.outputEncoding!==b&&(T.outputEncoding=b),T.toneMapping!==E&&(T.toneMapping=E),w.legacy!==_&&w.set(()=>({legacy:_})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==u&&w.set(()=>({flat:u})),r&&!I.fun(r)&&!pt(r)&&!I.equ(r,T,ne)&&fe(T,r),p&&!w.events.handlers&&w.set({events:p(f)});const P=hn(e,c);return I.equ(P,w.size,ne)||w.setSize(P.width,P.height,P.updateStyle,P.top,P.left),C&&w.viewport.dpr!==ut(C)&&w.setDpr(C),w.frameloop!==j&&w.setFrameloop(j),w.onPointerMissed||w.set({onPointerMissed:k}),D&&!I.equ(D,w.performance,ne)&&w.set(R=>({performance:{...R.performance,...D}})),h=M,s=!0,this},render(n){return s||this.configure(),we.updateContainer(m.createElement(yn,{store:f,children:n,onCreated:h,rootElement:e}),g,null,()=>{}),f},unmount(){ht(e)}}}function yn({store:e,children:t,onCreated:o,rootElement:i}){return me(()=>{const a=e.getState();a.set(f=>({internal:{...f.internal,active:!0}})),o&&o(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),m.createElement(mt.Provider,{value:e},t)}function ht(e,t){const o=ae.get(e),i=o==null?void 0:o.fiber;if(i){const a=o==null?void 0:o.store.getState();a&&(a.internal.active=!1),we.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var f,g,h,s;a.events.disconnect==null||a.events.disconnect(),(f=a.gl)==null||(g=f.renderLists)==null||g.dispose==null||g.dispose(),(h=a.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),on(a),ae.delete(e),t&&t(e)}catch{}},500)})}}we.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const Te={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function bn(e){const{handlePointer:t}=cn(e);return{priority:1,enabled:!0,compute(o,i,a){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Te).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:a}=e.getState();(o=a.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:o=>{var i;const{set:a,events:f}=e.getState();f.disconnect==null||f.disconnect(),a(g=>({events:{...g.events,connected:o}})),Object.entries((i=f.handlers)!=null?i:[]).forEach(([g,h])=>{const[s,v]=Te[g];o.addEventListener(s,h,{passive:v})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([f,g])=>{if(i&&i.connected instanceof HTMLElement){const[h]=Te[f];i.connected.removeEventListener(h,g)}}),o(f=>({events:{...f.events,connected:void 0}}))}}}}const _n=m.forwardRef(function({children:t,fallback:o,resize:i,style:a,gl:f,events:g=bn,eventSource:h,eventPrefix:s,shadows:v,linear:n,flat:r,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:u,onPointerMissed:_,onCreated:x,...j},C){m.useMemo(()=>Qt($t),[]);const D=Zt(),[z,O]=Xt({scroll:!0,debounce:{scroll:50,resize:0},...i}),k=m.useRef(null),w=m.useRef(null);m.useImperativeHandle(C,()=>k.current);const T=at(_),[B,V]=m.useState(!1),[W,U]=m.useState(!1);if(B)throw B;if(W)throw W;const F=m.useRef(null);me(()=>{const E=k.current;O.width>0&&O.height>0&&E&&(F.current||(F.current=gn(E)),F.current.configure({gl:f,events:g,shadows:v,linear:n,flat:r,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:u,size:O,onPointerMissed:(...P)=>T.current==null?void 0:T.current(...P),onCreated:P=>{P.events.connect==null||P.events.connect(h?tn(h)?h.current:h:w.current),s&&P.setEvents({compute:(R,S)=>{const H=R[s+"X"],A=R[s+"Y"];S.pointer.set(H/S.size.width*2-1,-(A/S.size.height)*2+1),S.raycaster.setFromCamera(S.pointer,S.camera)}}),x==null||x(P)}}),F.current.render(m.createElement(D,null,m.createElement(lt,{set:U},m.createElement(m.Suspense,{fallback:m.createElement(nn,{set:V})},t)))))}),m.useEffect(()=>{const E=k.current;if(E)return()=>ht(E)},[]);const b=h?"none":"auto";return m.createElement("div",Y({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:b,...a}},j),m.createElement("div",{ref:z,style:{width:"100%",height:"100%"}},m.createElement("canvas",{ref:k,style:{display:"block"}},o)))}),Un=m.forwardRef(function(t,o){return m.createElement(Yt,null,m.createElement(_n,Y({},t,{ref:o})))}),ve=new G,We=new G,wn=new G;function Pn(e,t,o){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=o.width/2,f=o.height/2;return[i.x*a+a,-(i.y*f)+f]}function Mn(e,t){const o=ve.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),a=o.sub(i),f=t.getWorldDirection(wn);return a.angleTo(f)>Math.PI/2}function En(e,t,o,i){const a=ve.setFromMatrixPosition(e.matrixWorld),f=a.clone();f.project(t),o.setFromCamera(f,t);const g=o.intersectObjects(i,!0);if(g.length){const h=g[0].distance;return a.distanceTo(o.ray.origin)<h}return!0}function Cn(e,t){if(t instanceof ze)return t.zoom;if(t instanceof Fe){const o=ve.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,f=o.distanceTo(i);return 1/(2*Math.tan(a/2)*f)}else return 1}function xn(e,t,o){if(t instanceof Fe||t instanceof ze){const i=ve.setFromMatrixPosition(e.matrixWorld),a=We.setFromMatrixPosition(t.matrixWorld),f=i.distanceTo(a),g=(o[1]-o[0])/(t.far-t.near),h=o[1]-g*t.far;return Math.round(g*f+h)}}const De=e=>Math.abs(e)<1e-10?0:e;function gt(e,t,o=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=De(t[a]*e.elements[a])+(a!==15?",":")");return o+i}const Sn=(e=>t=>gt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Rn=(e=>(t,o)=>gt(t,e(o),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function jn(e){return e&&typeof e=="object"&&"current"in e}const qn=m.forwardRef(({children:e,eps:t=.001,style:o,className:i,prepend:a,center:f,fullscreen:g,portal:h,distanceFactor:s,sprite:v=!1,transform:n=!1,occlude:r,onOcclude:c,castShadow:d,receiveShadow:p,material:M,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:u=Pn,as:_="div",wrapperClass:x,pointerEvents:j="auto",...C},D)=>{const{gl:z,camera:O,scene:k,size:w,raycaster:T,events:B,viewport:V}=_e(),[W]=m.useState(()=>document.createElement(_)),U=m.useRef(),F=m.useRef(null),b=m.useRef(0),E=m.useRef([0,0]),P=m.useRef(null),R=m.useRef(null),S=(h==null?void 0:h.current)||B.connected||z.domElement.parentNode,H=m.useRef(null),A=m.useRef(!1),q=m.useMemo(()=>r&&r!=="blending"||Array.isArray(r)&&r.length&&jn(r[0]),[r]);m.useLayoutEffect(()=>{const N=z.domElement;r&&r==="blending"?(N.style.zIndex=`${Math.floor(l[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[r]),m.useLayoutEffect(()=>{if(F.current){const N=U.current=Jt(W);if(k.updateMatrixWorld(),n)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const L=u(F.current,O,w);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${L[0]}px,${L[1]}px,0);transform-origin:0 0;`}return S&&(a?S.prepend(W):S.appendChild(W)),()=>{S&&S.removeChild(W),N.unmount()}}},[S,n]),m.useLayoutEffect(()=>{x&&(W.className=x)},[x]);const $=m.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:f?"translate3d(-50%,-50%,0)":"none",...g&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...o},[o,f,g,w,n]),ee=m.useMemo(()=>({position:"absolute",pointerEvents:j}),[j]);m.useLayoutEffect(()=>{if(A.current=!1,n){var N;(N=U.current)==null||N.render(m.createElement("div",{ref:P,style:$},m.createElement("div",{ref:R,style:ee},m.createElement("div",{ref:D,className:i,style:o,children:e}))))}else{var L;(L=U.current)==null||L.render(m.createElement("div",{ref:D,style:$,className:i,children:e}))}});const te=m.useRef(!0);Ie(N=>{if(F.current){O.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const L=n?E.current:u(F.current,O,w);if(n||Math.abs(b.current-O.zoom)>t||Math.abs(E.current[0]-L[0])>t||Math.abs(E.current[1]-L[1])>t){const Z=Mn(F.current,O);let X=!1;q&&(r!=="blending"?X=[k]:Array.isArray(r)&&(X=r.map(K=>K.current)));const le=te.current;if(X){const K=En(F.current,O,T,X);te.current=K&&!Z}else te.current=!Z;le!==te.current&&(c?c(!te.current):W.style.display=te.current?"block":"none");const he=Math.floor(l[0]/2),yt=r?q?[l[0],he]:[he-1,0]:l;if(W.style.zIndex=`${xn(F.current,O,yt)}`,n){const[K,Be]=[w.width/2,w.height/2],Pe=O.projectionMatrix.elements[5]*Be,{isOrthographicCamera:$e,top:bt,left:_t,bottom:wt,right:Pt}=O,Mt=Sn(O.matrixWorldInverse),Et=$e?`scale(${Pe})translate(${De(-(Pt+_t)/2)}px,${De((bt+wt)/2)}px)`:`translateZ(${Pe}px)`;let J=F.current.matrixWorld;v&&(J=O.matrixWorldInverse.clone().transpose().copyPosition(J).scale(F.current.scale),J.elements[3]=J.elements[7]=J.elements[11]=0,J.elements[15]=1),W.style.width=w.width+"px",W.style.height=w.height+"px",W.style.perspective=$e?"":`${Pe}px`,P.current&&R.current&&(P.current.style.transform=`${Et}${Mt}translate(${K}px,${Be}px)`,R.current.style.transform=Rn(J,1/((s||10)/400)))}else{const K=s===void 0?1:Cn(F.current,O)*s;W.style.transform=`translate3d(${L[0]}px,${L[1]}px,0) scale(${K})`}E.current=L,b.current=O.zoom}}if(!q&&H.current&&!A.current)if(n){if(P.current){const L=P.current.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const{isOrthographicCamera:Z}=O;if(Z||y)C.scale&&(Array.isArray(C.scale)?C.scale instanceof G?H.current.scale.copy(C.scale.clone().divideScalar(1)):H.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):H.current.scale.setScalar(1/C.scale));else{const X=(s||10)/400,le=L.clientWidth*X,he=L.clientHeight*X;H.current.scale.set(le,he,1)}A.current=!0}}}else{const L=W.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const Z=1/V.factor,X=L.clientWidth*Z,le=L.clientHeight*Z;H.current.scale.set(X,le,1),A.current=!0}H.current.lookAt(N.camera.position)}});const He=m.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return m.createElement("group",Y({},C,{ref:F}),r&&!q&&m.createElement("mesh",{castShadow:d,receiveShadow:p,ref:H},y||m.createElement("planeGeometry",null),M||m.createElement("shaderMaterial",{side:Nt,vertexShader:He.vertexShader,fragmentShader:He.fragmentShader})))});let de=0;const Gn=tt(e=>(ge.onStart=(t,o,i)=>{e({active:!0,item:t,loaded:o,total:i,progress:(o-de)/(i-de)*100})},ge.onLoad=()=>{e({active:!1})},ge.onError=t=>e(o=>({errors:[...o.errors,t]})),ge.onProgress=(t,o,i)=>{o===i&&(de=i),e({active:!0,item:t,loaded:o,total:i,progress:(o-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));class On extends Ut{constructor(t){super(t),this.onBeforeCompile=(o,i)=>{const{isWebGL2:a}=i.capabilities;o.fragmentShader=o.fragmentShader.replace("#include <output_fragment>",`
        ${a?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const Vn=m.forwardRef((e,t)=>{const[o]=m.useState(()=>new On(null));return m.createElement("primitive",Y({},e,{object:o,ref:t,attach:"material"}))});let Q,pe;const Tn=m.createContext(null),Je=new qt,Qe=new G,kn=m.forwardRef(({children:e,range:t,limit:o=1e3,...i},a)=>{const f=m.useRef(null),[g,h]=m.useState([]),[[s,v,n]]=m.useState(()=>[new Float32Array(o*3),Float32Array.from({length:o*3},()=>1),Float32Array.from({length:o},()=>1)]);m.useEffect(()=>{f.current.geometry.attributes.position.needsUpdate=!0}),Ie(()=>{for(f.current.updateMatrix(),f.current.updateMatrixWorld(),Je.copy(f.current.matrixWorld).invert(),f.current.geometry.drawRange.count=Math.min(o,t!==void 0?t:o,g.length),Q=0;Q<g.length;Q++)pe=g[Q].current,pe.getWorldPosition(Qe).applyMatrix4(Je),Qe.toArray(s,Q*3),f.current.geometry.attributes.position.needsUpdate=!0,pe.matrixWorldNeedsUpdate=!0,pe.color.toArray(v,Q*3),f.current.geometry.attributes.color.needsUpdate=!0,n.set([pe.size],Q),f.current.geometry.attributes.size.needsUpdate=!0});const r=m.useMemo(()=>({getParent:()=>f,subscribe:c=>(h(d=>[...d,c]),()=>h(d=>d.filter(p=>p.current!==c.current)))}),[]);return m.createElement("points",Y({userData:{instances:g},matrixAutoUpdate:!1,ref:nt([a,f]),raycast:()=>null},i),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:se}),m.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:se}),m.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:se})),m.createElement(Tn.Provider,{value:r},e))}),An=m.forwardRef(({children:e,positions:t,colors:o,sizes:i,stride:a=3,...f},g)=>{const h=m.useRef(null);return Ie(()=>{const s=h.current.geometry.attributes;s.position.needsUpdate=!0,o&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),m.createElement("points",Y({ref:nt([g,h])},f),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:se}),o&&m.createElement("bufferAttribute",{attach:"attributes-color",count:o.length/a,array:o,itemSize:3,usage:se}),i&&m.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:se})),e)}),Xn=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(An,Y({},e,{ref:t})):m.createElement(kn,Y({},e,{ref:t})));function Yn({all:e,scene:t,camera:o}){const i=_e(({gl:g})=>g),a=_e(({camera:g})=>g),f=_e(({scene:g})=>g);return m.useLayoutEffect(()=>{const g=[];e&&(t||f).traverse(v=>{v.visible===!1&&(g.push(v),v.visible=!0)}),i.compile(t||f,o||a);const h=new Gt(128);new Vt(.01,1e5,h).update(i,t||f),h.dispose(),g.forEach(v=>v.visible=!1)},[]),null}export{Un as C,qn as H,Yn as P,Ie as a,Xn as b,Vn as c,Gn as u};
